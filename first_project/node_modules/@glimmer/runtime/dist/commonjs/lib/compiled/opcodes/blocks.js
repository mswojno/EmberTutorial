"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const opcodes_1 = require("../../opcodes");
opcodes_1.APPEND_OPCODES.add(20 /* OpenBlock */, (vm, { op1: _getBlock, op2: _args }) => {
    let inner = vm.constants.getOther(_getBlock);
    let rawArgs = vm.constants.getExpression(_args);
    let args = null;
    let block = inner.evaluate(vm);
    if (block) {
        args = rawArgs.evaluate(vm);
    }
    // FIXME: can we avoid doing this when we don't have a block?
    vm.pushCallerScope();
    if (block) {
        vm.invokeBlock(block, args || null);
    }
});
opcodes_1.APPEND_OPCODES.add(21 /* CloseBlock */, vm => vm.popScope());
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmxvY2tzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vbGliL2NvbXBpbGVkL29wY29kZXMvYmxvY2tzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBRUEsMkNBQWlFO0FBR2pFLHdCQUFjLENBQUMsR0FBRyxDQUFDLGtCQUFZLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUU7SUFDbEUsSUFBSSxLQUFLLEdBQUcsRUFBRSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQW1CLFNBQVMsQ0FBQyxDQUFDO0lBQy9ELElBQUksT0FBTyxHQUFHLEVBQUUsQ0FBQyxTQUFTLENBQUMsYUFBYSxDQUFlLEtBQUssQ0FBQyxDQUFDO0lBQzlELElBQUksSUFBSSxHQUEwQixJQUFJLENBQUM7SUFFdkMsSUFBSSxLQUFLLEdBQUcsS0FBSyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUUvQixFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQ1YsSUFBSSxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDOUIsQ0FBQztJQUVELDZEQUE2RDtJQUM3RCxFQUFFLENBQUMsZUFBZSxFQUFFLENBQUM7SUFFckIsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUNWLEVBQUUsQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLElBQUksSUFBSSxJQUFJLENBQUMsQ0FBQztJQUN0QyxDQUFDO0FBQ0gsQ0FBQyxDQUFDLENBQUM7QUFFSCx3QkFBYyxDQUFDLEdBQUcsQ0FBQyxtQkFBYSxFQUFFLEVBQUUsSUFBSSxFQUFFLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQyJ9